# 魔法方法

Python 里有一种方法，叫做魔法方法。Python 的类里提供的，两个下划线开始，两个下划线结束的方法，就是魔法方法，魔法方法在恰当的时候就会被激活，自动执行。 魔法方法的两个特点：

- 两侧各有两个下划线
- 由python官方定义好

### 1.`__init__`

`__init__()`方法，在创建一个对象时默认被调用，不需要手动调用。在开发中，如果希望在创建对象的同时，就设置对象的属性，可以对 `__init__` 方法进行改造。

注意：

```python
class Dog(object):
    def __init__(self, name,yanse):
        '''
        以__开始，并且以__结束，我们称之为魔术方法
        他们不需要手动的调用，会在适当的时机自动调用
        :param name:
        '''
        self.name = name
        self.color = yanse

    def wang(self):
        print(self.name +'在叫')
        print('颜色是' + self.color)
        print('self  0x%x' % id(self))
dog1 = Dog('旺财', 'yellow')
dog1.wang()
print(dog1.wang)
print('dog1  0x%x' % id(dog1))

dog2 = Dog('来福', 'black')
dog2.wang()
print(dog2.wang)
print('dog2 0x%x' % id(dog1))
```



1. `__init__()`方法在创建对象时，会默认被调用，不需要手动的调用这个方法。
2. `__init__()`方法里的self参数，在创建对象时不需要传递参数，python解释器会把创建好的对象引用直接赋值给self
3. 在类的内部，可以使用self来使用属性和调用方法；在类的外部，需要使用对象名来使用属性和调用方法。
4. 如果有多个对象，每个对象的属性是各自保存的，都有各自独立的地址。
5. 方法是所有对象共享的，只占用一份内存空间，方法被调用时会通过self来判断是哪个对象调用了实例方法

## 2.`__str__`方法

`__str__`方法返回对象的描述信息，使用`print()`函数打印对象时，其实调用的就是这个对象的`__str__`方法。必须由return:

如果想要修改对象的输出的结果，可以重写 `__str__` 方法。

```python
class Person:
    def __init__(self,name,age):
        self.name = name
        self.age = age

    def __str__(self):
        return '哈哈'

p  = Person('张三',18)
print(p)   # 哈哈  打印对象时，会自动调用对象的 __str__ 方法
```

一般情况下，我们在打印一个对象时，可能需要列出这个对象的所有属性。

```python
class Student:
    def __init__(self,name,score):
        self.name = name
        self.score = score
    def __str__(self):
        return '姓名是:{},成绩是{}分'.format(self.name,self.score)

s = Student('lisi',95)
print(s)   # 姓名是:lisi,成绩是95分
```

## 3. `__del__`方法

创建对象后，python解释器默认调用`__init__()`方法；

而当删除对象时，python解释器也会默认调用一个方法，这个方法为`__del__()`方法。

```python
class Student:
    def __init__(self,name,score):
        print('__init__方法被调用了')
        self.name = name
        self.score = score

    def __del__(self):
        print('__del__方法被调用了')
s = Student('lisi',95)
del s
while True:
    input('请输入内容')
```

# 练习

要求：

1. 士兵张三有一把M416
2. 枪能够装填子弹
3. 枪能够发射子弹
4. 如果士兵没有枪，无法开火
5. 如果枪里没有子弹，需要装填子弹
6. 如果有枪又有子弹，则可以开火

![img](imgs/士兵突击.png)

```python
class Gun:
    def __init__(self,type):
        self.type = type
        self.bullet_count = 0

    def add_bullet(self,count):
        self.bullet_count += count

    def shoot(self):
        if self.bullet_count <= 0:
            print('枪里没有子弹')
            return

        print("发射了一发子弹")
        self.bullet_count -= 1

class Solider:
    def __init__(self,name):
        self.name = name
        self.gun = None

    def fire(self,count):
        if self.gun is None:
            print('没有枪，无法开火')
            return

        print('%s冲啊'%self.name)
        self.gun.add_bullet(count)
        self.gun.shoot()
        print('还剩%d发子弹'%self.gun.bullet_count)

gun = Gun('M416')
solider = Solider('张三')
solider.gun = gun
solider.fire(50)
```