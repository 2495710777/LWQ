# 闭包

函数还可以嵌套定义，即在一个函数内部可以定义另一个函数，有了嵌套函数这种结构，便会产生闭包问题。

## 什么是闭包

闭包是由函数及其相关的引用环境组合而成的实体(即：**闭包=函数块+引用环境**)。

```python
def outer(n):
    num = n
    def inner():
        return num+1
    return inner

print(outer(3)())  # 4
print(outer(5)())  # 5
```

**如果在一个内部函数里，对在外部作用域（但不是在全局作用域）的变量进行引用，那么内部函数就被认为是闭包(closure).**

## 修改外部变量的值

闭包里默认不能修改外部变量。

```python
def outer(n):
    num = n
    def inner():
        num = num + 1
        return num
    return inner

print(outer(1)())
```

上述代码运行时会报错！

```
UnboundLocalError: local variable 'num' referenced before assignment
```

因为跟全局变量和局部变量一样，如果想修改上一级的变量，需要引用关键字nonlocal

```python
def outer(n):
    num = n
    def inner():
        nonlocal num  # 修改前使用nonlocal关键字对 num 变量进行说明
        num = num + 1
        return num
    return inner

print(outer(2)()) # 3
```