# 文件的读写

## <1>写数据(write)

使用write()可以完成向文件写入数据

demo: 新建一个文件 `file_write_test.py`,向其中写入如下代码:

```python
f = open('test.txt', 'w')
f.write('hello world, i am here!\n' * 5)
f.close()
Copy
```

运行之后会在`file_write_test.py`文件所在的路径中创建一个文件`test.txt`,并写入内容，运行效果显示如下: ![img](imgs/文件写入.png)

注意：

- 如果文件不存在，那么创建；如果存在那么就先清空，然后写入数据

## <2>读数据(read)

使用read(num)可以从文件中读取数据，num表示要从文件中读取的数据的长度（单位是字节），如果没有传入num，那么就表示读取文件中所有的数据

demo: 新建一个文件`file_read_test.py`，向其中写入如下代码:

```python
f = open('test.txt', 'r')
content = f.read(5)  # 最多读取5个数据
print(content)

print("-"*30)  # 分割线，用来测试

content = f.read()  # 从上次读取的位置继续读取剩下的所有的数据
print(content)

f.close()  # 关闭文件，这个可是个好习惯哦
Copy
```

运行现象：

```
hello
------------------------------
 world, i am here!
Copy
```

注意：

- 如果用open打开文件时，如果使用的"r"，那么可以省略 `open('test.txt')`

## <3>读数据（readline）

readline只用来读取一行数据。

```python
f = open('test.txt', 'r')

content = f.readline()
print("1:%s" % content)

content = f.readline()
print("2:%s" % content)


f.close()
Copy
```

## <4>读数据（readlines）

readlines可以按照行的方式把整个文件中的内容进行一次性读取，并且返回的是一个列表，其中每一行为列表的一个元素。

```python
f = open('test.txt', 'r')
content = f.readlines()
print(type(content))

for temp in content:
    print(temp)

f.close()
Copy
```

# 指针定位

- tell() 方法用来显示当前指针的位置

  ```python
    f = open('test.txt')
    print(f.read(10))  # read 指定读取的字节数
    print(f.tell())    # tell()方法显示当前文件指针所在的文字
    f.close()
  Copy
  ```

- seek(offset,whence) 方法用来重新设定指针的位置。

  - offset:表示偏移量
  - whence:只能传入012中的一个数字。
    - 0表示从文件头开始
    - 1表示从当前位置开始
    - 2 表示从文件的末尾开始

  ```python
  f = open('test.txt','rb')  # 需要指定打开模式为rb,只读二进制模式
  
  print(f.read(3))
  print(f.tell())
  
  f.seek(2,0)   # 从文件的开头开始，跳过两个字节
  print(f.read())
  
  f.seek(1,1) # 从当前位置开始，跳过一个字节
  print(f.read())
  
  f.seek(-4,2) # 从文件末尾开始，往前跳过四个字节
  print(f.read())
  
  f.close()
  ```

```python
# with 关键字 可以实现文件的关闭
with open('demo.txt','w') as file:
    file.write('hi')
```

### 序列化和反序列化

序列化：把一个数据（列表，元组，对象）保存到硬盘里的过程，成为序列化

反序列化：把硬盘里的数据（对象）加载到程序里的过程 称为反序列化

在python里有pickle和json模块可以实现数据的序列化和反序列化

```python
import pickle

names = ['张三', '李四', 'henry','tom']

# 反序列化： load  loads

file = open('demo.txt', 'wb')
pickle.dump(names,file)
file.close()

file = open('demo.txt', 'rb')
print(pickle.load(file))
file.close()
#
# 序列化：dump  dumps
# result = pickle.dumps(names)  # dumps 方法会把列表转换成为二进制
# print(result)
# # 把二进制写入文件中
# file.write(result)

# 直接把一个对象写入文件里
# pickle.dump(names, file)
# 当dump结束之后，要手动的关闭文件流，如果不关闭，直接读取加载会报错！
# file.close()

# r_file = open('demo.txt', 'rb')
# print(pickle.load(r_file))
# r_file.close()

#
# class Person(object):
#     def __init__(self, name, age):
#         self.name = name
#         self.age = age
#
#     def eat(self):
#         print(self.name+'正在吃饭')
#
#
# p = Person('tony', 19)
# p_file = open('p.txt', 'wb')
# pickle.dump(p, p_file)
# p_file.close()
#
# rp_file = open('p.txt', 'rb')
# obj = pickle.load(rp_file)
# print(obj.name)
# obj.eat()
# rp_file.close()


class Person:
    def __init__(self,name,age):
        self.name = name
        self.age = age
    def eat(self):
        return self.name + '正在吃东西哦'
# 对象序列化


p = Person('王五',19)
file = open('p.txt','wb')
pickle.dump(p,file)
file.close()
# 对象反序列化
file = open('p.txt', 'rb')
p = pickle.load(file)
print(p.name)
print(p.eat())
file.close()
```

#### dump与dumps区别

```
result = pickle.dumps(p)
```

dumps是先把数据变成二进制数据

在写入文件

```
file.write(result)
```

dump是直接把数据写入文件，需要两个参数

```
pickle.dump(p, w_file)
```

#### load与loads

loads 需要一个参数（数据），把其转换为对象

```
p1 = pickle.loads(result)
print(p1.name)
```

```
load 需要一个有读取权限的文件流
p2 = pickle.load(r_file)
```

### json模块

主要就是dump时，参数必须是json格式

```python
import json
# 用来传递数据，保存对象的某些属性，方法不能使用


class Person(object):
    def __init__(self, name, age):
        self.name = name
        self.age = age

    def eat(self):
        print(self.name + '正在吃饭')


p = Person('张三', 18)
# print(p.__dict__)

# 转化成为json字符串（字典）格式
# result = json.dumps(p.__dict__)
# # print(type(result))
# w_file = open('json_p.txt', 'w')
# # 把json字符串写入文件
# w_file.write(result)
# w_file.close()


w_file = open('json_p.txt', 'w')
#
# json.dump(p, w_file)
# 直接放进文件
json.dump(p.__dict__, w_file)

w_file.close()

r_file = open('json_p.txt', 'r')
x = json.load(r_file)
print(x)
print(type(x))
print(x['name'])
r_file.close()

```

