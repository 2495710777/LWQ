## 数据库入门

### 一、数据库及其发展史

数据库是用来存储数据的，数据存储在数据库中的表结构中，表中存储的才是数据

要学习的有：数据库的连接、数据库的创建、表的创建、数据的管理、优化、便捷操作、关系的理解

#### 1 萌芽阶段

所有的数据都是存储在文件中的，安全性低，操作性繁琐

#### 2 层次模型

1、优点：

​	查询分类的效率比较高

2、缺点：

- 没有导航结构，导致分类困难
- 数据不完整

注意：数据的不完整，如果不能准确的分辨两条数据有什么不同，称之为失去了‘数据的完整性’

#### 3 网状模型

没有解决导航问题，但是解决了数据完整性的问题

#### 4 关系模型

当今最主流的模型，现在的主流的数据库都是关系模型的

特点：

- 每张表都是独立的，没有导航结构
- 表与表之间会建立公共字段，也就在两张表之间建立了关系

注意：公共的字段名可以不一样，但是数据类型必须相同（数据类型相同的不一定是公共字段），这两个字段的含义必须也要一致

关系型数据库，解决了数据的完整性，也解决了导航问题，但是带来的是低效率

NOSQL（非关系型数据库）：MongoDB，Redis

## 二、数据库相关术语和概念

- 数据库：数据库是一些关联表的集合
- 数据表：表是数据的矩阵，在一个数据库中的表看起来像一个简单的电子表格
- 列：一列（数据元素）包含了相同类型的数据、
- 行：一行（元组，或记录）是一组相关的数据
- 冗余：存储两倍数据，冗余降低了性能，但提高了数据的安全性
- 主键：主键是唯一的，一个数据表只能包含一个主键，可以使用主键查询数据

- 外键：外键用于关联两个表
- 复合键：复合键（组合键）将多个列作为一个索引键，一般用于复合索引

- 索引： 使⽤索引可快速访问数据库表中的特定信息。索引是对数据库表中⼀列

  或多列的值进⾏排序的⼀种结构。类似于书籍的⽬录。

- 参照完整性： 参照的完整性要求关系中不允许引⽤不存在的实体。与实体完

  整性是关系模型必须满⾜的完整性约束条件，⽬的是保证数据的⼀致性。

## 三、Linux数据库的开启与连接

#### 安装数据库

```
sudo apt install -y mysql-server mysql-client
```

#### 开启数据库服务

- Ubuntn：`service mysql start|stop|restart|status`
- Deepin:  `systemctl start|stop|restart|status mysqld`
- CentOS7: ` systemctl start|stop|restart|status mysqld`
- CentOS6:  `service mysqld start|stop|restart|status`

#### 连接数据库

各个Linux系统连接数据库都一样

格式：`mysql -h localhost -u root -p password `

- -h ： host(ip地址) localhost=127.0.0.1
- -u : username(用户账户)
- -p (小写): password(密码)
- -P(大写) : port（端口号，默认端口为3306）                         

使用 mycli 工具操作数据库，有提示语句，方便一点，需要下载，然后

- vim ~/.bashrc 在最先面添加环境变量 

  export  PATH=$HOME/.local/bin:$PATH

- 在root数据库中创建一个新用户
- 使用 mycli 登录数据库就可以了

注意：

第一次使用root连接后最好添加一个新用户来操作，出于安全考虑，日常开发中最好不要使用root

```linux
-- 创建新用户，并设置密码
/*主机名可以使用‘%’，代表允许该用户从任何机器登录
*.*代表该用户可以操作任何库，任何表*/
grant all privileges on *.* to '用户名'@'主机名' identified by '密码' with grant option

--刷新使权限生效
flush privileges;
```

#### 退出数据库

四种方式：

- exit
- quit
- \q
- 快捷键：ctrl+d

#### 密码忘记怎么办?

1. 打开配置: vim /etc/mysql/my.cnf

2. 添加这么⼀段:

  ```
  [mysqld]
  skip-grant-tables
  ```

  如果⽂件中已存在 [mysqld] , 则直接将 skip-grant-tables 写到其下⽅即可。

3. 修改完成后，保存退出，重启服务: sudo systemctl restart mysqld

## 四、SQL语言概览

SQL:Structured  Query Language,即*结构化查询语言*

结构化：表里的数据结构，字段类型是定义好的，非常规整

非结构化：json,不需要每一行每一列定义好，键值对的 形式直接插进去就行，操作更灵活

SQL是一种特殊目的的编程语言，是一种数据库查询和程序设计语言，用于存储数据以及查询、更新和管理关系数据库系统，同时也是数据库脚本文件的扩展名。

### 关系型数据库

| 数据库     | SQL类型          | 公司               |
| ---------- | ---------------- | ------------------ |
| Access     | SQL              | 微软               |
| SQL-Server | T-SQL            | 微软               |
| Oracle     | PL/SQL           | 甲骨文             |
| MySQL      | My/SQL           | 甲骨文             |
| SQLite     | 内嵌型小型数据库 | 移动前端用的比较多 |

## 五、数据库操作

### 1、创建数据库

```less
create database [if not exists] `数据库名` charset=字符编码(utf8mb4);
```

- 如果多次创建会报错
- 字符编码不指定默认utf8mb4
- 给数据库命名一定要习惯性加上反引号，防止与关键字冲突

### 2、查看数据库

```sql
show databases
```

### 3、选择数据库

```sql
use `数据库名字`
```

### 4、修改数据库

```sql
-- 只能修改字符集
alter database `数据库名` charset=字符集
```

### 5、删除数据库

```mysql
drop database [if exists] `数据库名`
```

## 六、表的操作

###	1、创建表

```mysql
create table [if not exists] `表名`（
	id int not null auto_increment primary key comment '主键', 
	-- auto_increment 自动递增 comment 对字段进行描述，没有实际意义
	account char(225) comment '用户名' default 'admin'
	-- default  字段的默认值
	pwd varchar(65536) comment '密码' not null
）engine=myisam charset=utf8md4;
```

备注:

- 名称和字段类型必须要有，其他的无所谓

- 字符集如果不指定, 默认继承库的字符集.
- engine 默认innodb

### 2、查看所有表

只有在选择数据库之后，才能查看库中的数据表

```mysql
show tables;
```

### 3、查看表结构

```mysql
desc `表名`;
describe `表名`;
```

### 4、查看表记录数据

```mysql
select * from `表名`
```

### 5、删除表

必须在数据库中删除数据表

```mysql
drop table [if exists] `表名`
```

### 6、修改表

```mysql
-- 修改表的名称
alter table `old_name` rename `new_name`;
-- 修改表的引擎
alter table `表名` engine=innodb | myisam;
-- 移动表 到指定的数据库
alter table `表名` rename to 数据库名.表名;
```

### 7、修改字段

```mysql
-- 增加一个新的字段
alter table `表名` add 字段名 数据类型 属性;
-- 增加一个新的字段，并且放在第一行
alter table `表名` add 字段名 数据类型 属性 first;
-- 增加一个新的字段，并放在指定字段的后面
alter table `表名` add 字段名 数据类型 属性 after 指定字段名;
-- 修改字段的属性
alter table `表名` modify 字段名 数据类型 属性;
-- 修改字段的名称
alter table `表名` change 原字段名 新字段名 数据类型 属性;
-- 修改字段位置
alter table `表名` change 原字段名 新的字段名 数据类型 after 指定字段
-- 删除字段
alter table `表名` drop `字段名`
```

### 8、复制表

```mysql
create table student1(
    sno int auto_increment primary key,
    sname char(20),
    score int)engine=myisam;
 insert into student1 values (1,'mimi',84),(2,'lwq',91),(3,'min',79);
```

- 复制表，并且复制数据

  操作:

  ```mysql
  create table `student2` select * from `student1`;
  ```

  特点: 复制⼀个表，有原表的数据，没有原表的结构，即字段的属性

- 仅复制表结构, 不复制数据
  操作:

```mysql
 create table `student3` like `student1`;
```

特点: 复制后的表结构与原表相同，但是⾥⾯没有数据，是⼀张空表

如果需要，数据可以单独复制

```mysql
insert into `student3` select * from `student1`;
```

这样便可把一张表完整的复制下来

## 七、CURD 语句的基本使⽤
对表中数据的操作⼀般分为四类, 常记做 "CURD"即:

- C: 创建（Create）
- U: 更新（Update）
- R: 读取（Retrieve）
- D: 删除（Delete）

#### 1.INSERT 插⼊
完整的 insert 语句为:

```mysql
INSERT INTO `表名` (`字段1`, `字段2`, ...) VALUES (`值1`, `值2`, ...);
```

其中的 INTO 在 MySQL 数据库中可以省略, 但在某些数据库中必须要有。

```mysql
-- ⼀次插⼊⼀⾏
insert into `表名` set `字段`=值, `字段`=值;
-- 按照指定字段, ⼀次插⼊多⾏
insert into `表名` (字段1, 字段2 ...) values (值1, 值2, ...), (值1, 值2, ...);
-- 指定全部字段, ⼀次插⼊多⾏
insert into `表名` values (null, 值1, 值2, ...), (null, 值1, 值2, ...);
```

#### 2、SELECT(查询)

```mysql
-- 通过 * 获取全部字段的数据
select * from `表名`;
-- 获取指定字段的数据
select `字段1`, `字段2` from `表名`;
-- 获取满足条件的
select * from `表名` where 字段名=值;
```

#### 3、UPDATE(更新)

```mysql
-- 修改全表数据
update 表名 set 字段1=值，字段2=值;

-- 使用where修改满足条件的元组（行）
-- where类似于if 条件，只执行返回结果为true的语句
update 表名 set 字段1=值,字段2=值 where 字段=值;
update 表名 set 字段1=值,字段2=值 where 字段=值 and 字段=值;
```

#### 4、DELETE(删除)

```mysql
-- 删除表中的所有数据(逐行删除)
delete from 表名;
-- 多行被影响，会被记录到底层的日志里面，对表本身的结构不影响
-- 清空全表(一次性删除表内全部数据)
truncate 表名
-- 不管多少数据，一下清空，0行被影响，不会记录到日志里面，不影响表结构
-- 使用where 修改满足条件的行
delete from 表名 where 字段=值;
delete from 表名 where 字段 in(1,2,3,4);
```

