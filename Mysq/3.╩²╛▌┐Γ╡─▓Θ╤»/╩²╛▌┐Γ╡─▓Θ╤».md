## 一、构造数据

首先创建两张表：

1.学生表

```mysql
create table student (
 `id` int unsigned primary key auto_increment,
 `name` char(32) not null unique,
 `sex` enum('男', '⼥') not null,
 `city` char(32) not null,
 `description` text,
 `birthday` date not null default '1995-1-1',
 `only_child` boolean
) charset=utf8;
insert into student
(`name`, `sex`, `city`, `description`, `birthday`, `only_child`)
values
('刘邦', '男', '北京', '班⻓', '1997/10/1', True),
('陈乔恩', '⼥', '上海', NULL, '1995/3/2', True),
('张国荣', '男', '北京', '这孩⼦贼棒', '1996/9/9', True),
('赵丽颖', '⼥', '北京', '班花, 不骄傲', '1995/4/4', False),
('王宝强', '男', '重庆', '阳光⼤男孩, 超爱吃⽕锅', '1998/10/5', False),
('赵雅芝', '⼥', '重庆', '全宇宙三好学⽣', '1996/7/9', True),
('张学友', '男', '上海', '全国数学奥林匹克竞赛冠军, 还有谁！', '1993/5/2', False),
('陈意涵', '⼥', '上海', NULL, '1994/8/30', True),
('赵本⼭', '男', '南京', '这家伙很懒, 什么都没留下', '1995/6/1', True),
('张柏芝', '⼥', '上海', '这家伙很勤奋, 但还是什么都没留下。。。', '1997/11/28',
False);
```

2、成绩表

```mysql
create table score (
 `id` int unsigned primary key auto_increment,
 `math` float not null default 0,
 `english` float not null default 0
) charset=utf8;
insert into score (`math`, `english`)
values
(49, 71), (62, 66.7), (44, 86), (77.5, 74), (41, 75),
(82, 59.5), (64.5, 85), (62, 98), (44, 36), (67, 56);
```

## 二、常用的查询语句

### 1、select：字段表达式

- select既可以做查询，又可以做输出

- 如：

  ```mysql
  select rand(); -- 生成0-1的随机数0.4637945308012837
  select unix_timestamp-- 显示unix的时间戳 1567588230 
  select id,name from student;
  ```

### 2、from子句

- 语法：`select 字段 from 表名`

- from后面是**数据源**，数据源可以写多个，数据源一般是表名，也可以是其他查询的结果

- 如：

  ```mysql
  select student.name,score.math from student, score;
  -- 筛选出来的数据是笛卡尔积的形式，即左表的每一个数据都和右边进行配对
  ```

### 3、where子句：按指定的条件过滤

- 语法：`select 字段 from 表名 where 条件`;

- where 是做条件查询，只返回结果为true的数据

- 如：

  ```mysql
  select name from student where city='上海';
  ```

- 空值判断：`is null 和 is not null`

  ```mysql
  select name from student where description is null;
  select name from student where description is not null;
  这里为空不能用 ‘=’  不为空可以用‘<=>’ 
  ```

- 范围判断：`between ... and ... 和 not between...and... 

  ```mysql
  select id, math from score where math between 60 and 70;
  select id, math from score where math not between 60 and 70;
  select * from score where math>=80 and english<=60; -- 直接做⽐较判断
  ```

### 4、group by :分组查询

- 按照某一字段进行分组，会把该字段中值相同的归为一组，将查询的结果分类显示，方便统计

- 如果有where，则要放在where后面

- 语法：select 字段 from 表名 group by 分组字段；

- 如：

  ```mysql
  select sex, count(id) from student group by sex;
  -- 在group将需要的结果拼接
  select sex, group_concat(name) from student group by sex;
  -- 添加where语句
  -- 按性别分组, 将上海地区的男⽣⼥⽣姓名连接起来
  select sex, group_concat(name) from student where city='上海' group by sex;
  ```

### 5、having

- having 与 where 在 sql 中增加 having 子句的原因是，where关键字无法与聚合函数一起使用

- 语法：select 字段 from 表名 having 条件；

- where： 后面不能加上聚合函数，它只能写在数据源的后面

- having：**条件字段必须要在结果集中出现**having可以写在group by 的后面

  ```mysql
  select `name`, `birthday` from `student` where `birthday` > '1995-1-1';
  select `name`, `birthday` from `student` having `birthday` > '1995-1-1';
  select `name` from `student` where `id` >= 5;
  select `name` from `student` having `id` >= 5; -- 错误
  select * from student where id>=3 and city='北京';
  select * from student having id>=3 and city='北京';
  select * from student where id>=3 having city='北京'; -- 混⽤
  -- 取出每个城市中满⾜最⼩出⽣年份⼤于1995的
  select city, group_concat(birthday) from student group by city having min(birthday) > '1995-1-1';
  ```

### 6、order by ： 按字段排序

- order by 主要作用是排序
- order by 写在group by 后面，如果有having也要写在having后面
- 语法：select 字段 from 表名 order by 排序字段 asc | desc

- 升序 asc(默认，可不写)，降序 desc

- 如：

  ```mysql
  select * from student order by age;
  select * from student order by age desc;
  ```

### 7、limit:限制取出数量

```mysql
select 字段 from 表名 limit m; -- 从第一行到第m行
select 字段 from 表名 limit m, n; -- 从第m行开始，往下取n行
select 字段 from 表名 limit m offset n; -- 跳过前n行，取后面的m行 
```

### 8、distinct:去重

`select distinct city from student;`

### 9、dual表

dual是一个虚拟表，仅仅为了保证`select ... from ...`语句的完整性

```mysql
select now() from dual;
```

### 三、函数

#### 聚合函数

| Name             | Description                  |
| ---------------- | ---------------------------- |
| avg()            | 返回参数的平均值             |
| bit_and()        | 按位返回and与运算            |
| bit_or()         | 按位返回or或运算             |
| bit_xor()        | 按位返回异或运算             |
| count()          | 返回返回的行数               |
| count(distinct)  | 返回去重过后，不同值的计数   |
| group_concat()   | 返回连接的字符串             |
| json_arrayagg()  | 将结果集作为单个JSON数组返回 |
| json_objectagg() | 将结果集作为单个JSON对象返回 |
| max()            | 返回最大值                   |
| min()            | 返回最小值                   |
| std()            | 返回样本的标准差             |
| stddev()         | 返回样本的标准差             |
| stddev_pop()     | 返回样本的标准差             |
| stddev_samp()    | 返回样本的标准差             |
| sum()            | 归还总和                     |
| var_pop()        | 返回样本的标准差异           |
| var_samp()       | 返回样本方差                 |
| variance()       | 返回样本的标准差异           |

#### 数值计算类函数

![1567595646999](C:\Users\lwq\Desktop\Mysql笔记\数据库的查询\1567595646999.png)

#### 日期计算类函数

![1567595720879](C:\Users\lwq\Desktop\Mysql笔记\数据库的查询\1567595720879.png)

#### 字符串相关函数

![1567595748079](C:\Users\lwq\Desktop\Mysql笔记\数据库的查询\1567595748079.png)

#### 其他函数

![1567595826552](C:\Users\lwq\Desktop\Mysql笔记\数据库的查询\1567595826552.png)

## 四、多表查询

#### union联合查询

union操作符用于合并两个或多个select语句的结果集

union要求：

- 两边select语句的字段数必须一样

- 两边可以具有不同数据类型的字段

- 字段名默认按照左边的表来设置

- 用法：

  ```mysql
  select id,name from student 
  union 
  select id,math from score;
  ```

#### inner join:内连接（交集）

​											![](C:\Users\lwq\Desktop\Mysql笔记\数据库的查询\1567596398686.png)

- inner join关键字在表中存在至少一哥匹配时返回行

- 语法：

  ```mysql
  select name from student 
  inner join score 
  on student.id = score.id;
  -- 此时不带inner也可
  ```

#### left join :左连接

​											![1567596758132](C:\Users\lwq\Desktop\Mysql笔记\数据库的查询\1567596758132.png)

- left join 关键字从左表返回所有的行，即使右边没有匹配的值，结果为null

- 语法：

  ```mysql
  select name from student 
  left outer join score 
  on student.id = score.id;
  -- 不带outer也行
  ```

#### right join: 右连接

​									![1567596957990](C:\Users\lwq\Desktop\Mysql笔记\数据库的查询\1567596957990.png)

- right join 关键字从右表返回所有的行，即使左表无匹配，，结果为null

- 语法：

  ```mysql
  select name from student 
  right outer join score 
  on student.id = score.id;
  -- 不带outer也行
  ```

## 子查询

```mysql
select name from student where id in (select id from score where math > 10);
```

